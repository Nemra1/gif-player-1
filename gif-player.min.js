
function gifPlayer(cont,opts){var defaults={autoplay:true,play:function(s,m,b){s.hide();m.show()},stop:function(m,s,b){m.hide();s.show()}};var opts=$.extend({},defaults,opts);var c=cont;var s=cont.find('.gif-still');var m=cont.find('.gif-movie');var i=new Image;var state='e';var busy=false;var setState=function(was,now){c.removeClass('gif-player-'+was);c.addClass('gif-player-'+now);state=now;}
this.act=function()
{if(busy)
return;switch(state)
{case'e':setState('e','l');m.load(function(){i.src=m.attr('src');m.unbind('load');if(opts['autoplay'])
{setState('l','p');opts['play'](s,m,busy);}
else
setState('l','s');});m.attr('src',m.attr('gif'));break;case'l':setState('l','e');m.unbind('load');m.attr('src','');break;case's':m.attr('src',null).attr('src',i.src);setState('s','p');opts['play'](s,m,busy);break;case'p':setState('p','s');opts['stop'](m,s,busy);break;}}
var that=this;c.find('.gif-ctrl').click(function(){that.act();});c.addClass('gif-player-e');m.hide();s.show();}